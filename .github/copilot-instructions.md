# Copilot Instructions for the `icemodels` Repository

This document provides guidance for AI coding agents working on the `icemodels` repository. It outlines the project's structure, key workflows, and conventions to ensure productive contributions.

## Project Overview

The `icemodels` repository is a Python-based project for modeling and analyzing astrophysical ice features. It includes tools for generating synthetic spectra, analyzing observational data, and creating visualizations.

### Key Components
- **Core Library**: Located in `icemodels/`, this contains the main functionality, including:
  - `core.py`: Core modeling logic.
  - `plot_seds.py`: Tools for plotting Spectral Energy Distributions (SEDs) with ice absorption overlaid; this is mostly for demonstrations.
  - `colorcolordiagrams.py`: Tools for adding ice opacity models to color-color diagrams by analogy to extinction vectors.
  - `absorbance_in_filters.py`: Functions for calculating absorbance in filters from the SVO FPS.  This is used to precompute stellar colors in specified filters.
- **Examples**: Found in `examples/`, these scripts demonstrate how to use the library.
- **Documentation**: Located in `docs/`, it includes Sphinx-based documentation and example plots.
- **Tests**: Found in `icemodels/tests/`, this directory contains unit tests.

## Developer Workflows

### General

Do not use try/except blocks when writing python code.  If an exception is encountered, it should be exposed to the user and corrected.  There are no circumstances ever in which a bare 'except:' should be used.  There are a very limited set of circumstances in which try/except ExceptionType: can be used, but you must ask permission before using that construct.

Do not use virtual environments.  Use pre-existing conda environments, or if absolutely necessary, create new conda environments.

### Building the Project
- Use `pip install .` to install the package locally.
- Dependencies are managed via `pyproject.toml` and `setup.cfg`.

### Testing
- Run tests using `pytest`:
  ```bash
  pytest icemodels/tests/
  ```
- Ensure new features are covered by unit tests.

### Documentation
- Build the documentation locally:
  ```bash
  cd docs
  make html
  ```
- Open the generated HTML files in `docs/_build/html/` to preview.

## Project-Specific Conventions

### Code Style
- Follow PEP 8 for Python code.
- Use docstrings to document all functions and classes.

### File Organization
- Place reusable components in `icemodels/`.
- Examples should be added to `examples/`.
- Tests for new features should go in `icemodels/tests/`.

### Naming Conventions
- Use descriptive names for functions and variables.
- Prefix private functions with an underscore (`_`).

## Integration Points

### External Dependencies
- The project relies on standard Python libraries and some astrophysics-specific packages (e.g., `astropy`).
- Ensure all dependencies are listed in `pyproject.toml`.

### Cross-Component Communication
- The `core.py` module serves as the central hub for the library.
- Visualization tools in `plot_seds.py` depend on data generated by `core.py`.

## Examples

### Adding a New Feature
1. Implement the feature in the appropriate module within `icemodels/`.
2. Add an example usage in `examples/`.
3. Write unit tests in `icemodels/tests/`.

### Debugging
- Leverage logging for tracing issues in `core.py`.

## Additional Resources
- [Project Documentation](https://keflavich.github.io/icemodels/)
- Example notebook: `notebooks/CO2_Phoenix_Example.ipynb`.

---

This document is a living guide. Update it as the project evolves to ensure AI agents remain effective contributors.